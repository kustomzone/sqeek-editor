var db=new SQL.open();function initDatabase(){try{if(!window.openDatabase){alert("Databases are not supported in this browser.");}else{console.log("Database ready.. (maybe)");}}catch(e){if(e==2){console.log("Invalid database version.");}else{console.log("Unknown error: "+e+".");}return;}}function createTable(){db.transaction(function(tx){tx.executeSql(createStatement,[],showRecords,onError);});}function insertRecord(){var usernametemp=$("input:text[id=username]").val();var useremailtemp=$("input:text[id=useremail]").val();db.transaction(function(tx){tx.executeSql(insertStatement,[usernametemp,useremailtemp],loadAndReset,onError);});}function deleteRecord(id){var iddelete=id.toString();db.transaction(function(tx){tx.executeSql(deleteStatement,[id],showRecords,onError);alert("Record Deleted");});resetForm();}function updateRecord(){var usernameupdate=$("input:text[id=username]").val().toString();var useremailupdate=$("input:text[id=useremail]").val().toString();var useridupdate=$("#id").val();db.transaction(function(tx){tx.executeSql(updateStatement,[usernameupdate,useremailupdate,Number(useridupdate)],loadAndReset,onError);});}function dropTable(){db.transaction(function(tx){tx.executeSql(dropStatement,[],showRecords,onError);});resetForm();initDatabase();}function loadRecord(i){var item=dataset.item(i);$("#username").val((item["username"]).toString());$("#useremail").val((item["useremail"]).toString());$("#id").val((item["id"]).toString());}function resetForm(){$("#username").val("");$("#useremail").val("");$("#id").val("");}function loadAndReset(){resetForm();showRecords();}function onError(tx,error){alert(error.message);}function showRecords(){$("#results").html("");db.transaction(function(tx){tx.executeSql(selectAllStatement,[],function(tx,result){dataset=result.rows;for(var i=0,item=null;i<dataset.length;i++){item=dataset.item(i);var linkeditdelete="<li>"+item["username"]+" , "+item["useremail"]+"	"+'<a href="#" onclick="loadRecord('+i+');">edit</a>'+"	"+'<a href="#" onclick="deleteRecord('+item["id"]+');">delete</a></li>';$("#results").append(linkeditdelete);}});});}var volume=5;var soundLoaded=new buzz.sound("ogg/sfx_flap.ogg");buzz.all().setVolume(volume);function execute(commands){var com=commands.replace(/\n/g,"; ");var con=document.getElementById("myconsole");var pre=document.createElement("pre");var span=document.createElement("span");span.style.color="red";con.appendChild(pre).innerHTML=com;console.debug(commands);try{var data=db.exec(com);var txt=JSON.stringify(data,null,"  ");out_edit.setValue(txt);return data;}catch(e){console.error(e);e=e+"<br><br>";con.appendChild(span).innerHTML=e;}}$("#fileselect").change(function(e){if(this.value){var file=this.files[0];var reader=new FileReader();reader.readAsArrayBuffer(file);reader.onload=function(e){loadTables(e.target.result,file);};reader.onerror=function(){$(fileStatus).addClass("alert-error").removeClass("hidden");fileStatus.innerText="Error! Unable to open file "+file.name+" size:"+file.size;};}});function doDrop(event,cb){var file=event.dataTransfer.files[0];var reader=new FileReader();reader.readAsArrayBuffer(file);reader.onload=function(e){loadTables(e.target.result,file);};reader.onerror=function(){$(fileStatus).addClass("alert-error").removeClass("hidden");fileStatus.innerText="Error! Unable to open file "+file.name+" size:"+file.size;};}function doSelect(filepath){var url="./"+filepath;var con=document.getElementById("myconsole");var pre=document.createElement("pre");con.appendChild(pre).innerHTML=url;var xhr=new XMLHttpRequest();xhr.open("GET",url,true);xhr.responseType="arraybuffer";xhr.onload=function(event){loadTables(xhr.response,filepath);};xhr.send();}dbLink0.onclick=function(event){doSelect(dbLink0.value);};dbLink1.onclick=function(event){doSelect(dbLink1.value);};dbLink2.onclick=function(event){doSelect(dbLink2.value);};dbLink3.onclick=function(event){doSelect(dbLink3.value);};dbLink4.onclick=function(event){doSelect(dbLink4.value);};dbLink5.onclick=function(event){doSelect(dbLink5.value);};dbLink6.onclick=function(event){doSelect(dbLink6.value);};function dragIn(z){["dragOut","error","success"].forEach(function(e){z.classList.remove(e);});}function dragOut(z){["dragEnter","error","success"].forEach(function(e){z.classList.remove(e);});}zone.ondragenter=function(){dragIn(zone);return false;};zone.ondragover=function(){dragIn(zone);return false;};zone.ondragleave=function(){dragOut(zone);return false;};function inherits(target,source){for(var k in source.prototype){target.prototype[k]=source.prototype[k];}}sqlButt.onclick=function(event){execute(commands.value);};zone.ondrop=function(event){doDrop(event,function(x){db=SQL.open(x);var q="SELECT name FROM sqlite_master WHERE type='table';";result=execute(q);$(".tables").empty();$.each(result,function(i,row){$(".tables").append($("<li />").append($("<a />").attr("href","#table_"+row[0].value).attr("data-table",row[0].value).attr("data-toggle","tab").text(row[0].value).on("click",showTable)));});});dragOut(zone);return false;};function loadTables(arraybuffer,file){zone.classList.remove("error");zone.classList.remove("success");var data=new Uint8Array(arraybuffer);db=SQL.open(data);var commands="SELECT name FROM sqlite_master WHERE type='table';";var result=db.exec(commands.replace(/\n/g,"; "));$(".tables").empty();$.each(result,function(i,row){$(".tables").append($("<li />").append($("<a />").attr("href","#table_"+row[0].value).attr("data-table",row[0].value).attr("data-toggle","tab").text(row[0].value).on("click",showTable)));});$(fileStatus).addClass("alert-success").removeClass("hidden");if(file){soundLoaded.play();$("#loaded").hide();$("#loaded").css("visibility","visible");$("#loaded").fadeIn(1000);if(file.name){var size=file.size;var name=file.name;}else{var size=data.byteLength;var name=file;}fileStatus.innerText="Opened: "+name+", size: "+Math.floor(size/1000)+"k";}else{fileStatus.innerText="no file details";}}function showTable(e){var $el=$(this),$table=$(".table-container"),table=$el.data("table"),q="SELECT * FROM "+table+" LIMIT 500;";$(".new-row").removeClass("hidden");$table.empty();result=execute(q);$.each(result,function(i,row){var $tr=$("<tr />"),$thead_tr=$("<tr />"),$tbody=$("<tbody />"),$thead=$("<thead />");if(i==0){$.each(row,function(k,header){$thead.append($thead_tr.append($("<th />").text(header.column)));});$table.append($thead);}$table.append($tbody);$.each(row,function(j,cell){$tbody.append($tr.append($("<td />").text(cell.value)));});});}$("#id_new-row-modal").on("show",function(){var table=$(".nav-tabs .active a").data("table");result=execute("pragma table_info('"+table+"');");$(".new-row-form").empty();$.each(result,function(i,col){if(col[5].value==="0"){$(".new-row-form").data("table",table).append($("<div />").addClass("control-group").append($("<label />").addClass("control-label").attr("for","id_"+col[1].value).text(col[1].value)).append($("<div />").addClass("controls").append($("<input />").data("col",col[1].value).attr("type","text").attr("id","id_"+col[1].value))));}});});$(".row-save").on("click",function(){var table=$(".new-row-form").data("table"),props=$(".new-row-form input").map(function(){return $(this).data("col");}).toArray(),vals=$(".new-row-form input").map(function(){return $(this).val();}).toArray();q="INSERT INTO `"+table+"` ("+props.join(", ")+")"+" VALUES ('"+vals.join("', '")+"')";result=execute(q);$(".nav-tabs .active a").triggerHandler("click");});$("[data-toggle=tooltip]").tooltip();